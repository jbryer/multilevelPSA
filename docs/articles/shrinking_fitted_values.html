<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Shrinking Fitted Values from Logistic Regression • multilevelPSA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shrinking Fitted Values from Logistic Regression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multilevelPSA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/multilevelPSA.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/shrinking_fitted_values.html">Shrinking Fitted Values from Logistic Regression</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jbryer/multilevelPSA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Shrinking Fitted Values from Logistic Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jbryer/multilevelPSA/blob/HEAD/vignettes/shrinking_fitted_values.Rmd" class="external-link"><code>vignettes/shrinking_fitted_values.Rmd</code></a></small>
      <div class="d-none name"><code>shrinking_fitted_values.Rmd</code></div>
    </div>

    
    
<p><em>Note: This is adapted from chapter 5 of my dissertation which is
available at <a href="https://github.com/jbryer/Dissertation" class="external-link uri">https://github.com/jbryer/Dissertation</a> for the full
context.</em></p>
<p>With regard to propensity score ranges, the range tends to shrink as
the ratio of treatment-to-control increases. Figure 20 depicts the range
and distribution of propensity scores (using logistic regression) with
varying treatment-to-control ratios. The data used to create this figure
is simulated and available in Appendix K. The psrange and plot.psrange
functions are included in the multilevelPSA R package. Propensity scores
are estimated with a single covariate where the mean for the treatment
and control are 0.6 and 0.4, respectively. The standard deviation for
both is 0.4. There are 100 treatment units and 1,000 control units
simulated. The goal in choosing these means and standard deviations is
to have some separation between treatment and control. Each row in the
figure represents the percentage of control units sampled before
estimating the propensity scores, starting with 100% (i.e. all 1,000
control units) to 10% (100 of the control units). As the figure shows,
as the ratio decreases to where there are equal treatment and control
units, the range of the propensity scores becomes more normal. To
calculate the ranges, each sampling step is bootstrapped so the green
bar and black points represent each of the 20 bootstrap samples taken.
The bars then represent the mean of the minimum and mean of the maximum
for each step.</p>
<p>The “shrinking” of propensity score ranges as the ratio of
treatment-to-control increases has implications for the interpretation
of propensity scores. Typically, propensity scores are interpreted as
the probability of being in the treatment. For studies where the number
of treatment and control units are roughly equal, this interpretation is
valid. However, in cases where the ratio of treatment-to-control is
large, it best to simply interpret the propensity scores as adjustment
scores and not probabilities. Since the matching and stratification
procedures utilize standard scores (i.e. the propensity score divided by
the standard deviation of the propensity scores), should only impact
interpretation of the propensity scores and should not impact on the
estimated treatment effects. It appears this issue has not been explored
in either the PSA or logistic regression literature and additional
exploration of the topic appears to be warranted.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jbryer.github.io/multilevelPSA/" class="external-link">multilevelPSA</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getSimulatedData</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nvars</span><span class="op">=</span><span class="fl">3</span>,</span>
<span>                             <span class="va">ntreat</span><span class="op">=</span><span class="fl">100</span>, <span class="va">treat.mean</span><span class="op">=</span><span class="fl">.6</span>, <span class="va">treat.sd</span><span class="op">=</span><span class="fl">.5</span>,</span>
<span>                             <span class="va">ncontrol</span><span class="op">=</span><span class="fl">1000</span>, <span class="va">control.mean</span><span class="op">=</span><span class="fl">.4</span>, <span class="va">control.sd</span><span class="op">=</span><span class="fl">.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">treat.mean</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="va">treat.mean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">treat.mean</span>, <span class="va">nvars</span><span class="op">)</span> <span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">treat.sd</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="va">treat.sd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">treat.sd</span>, <span class="va">nvars</span><span class="op">)</span> <span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">control.mean</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="va">control.mean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">control.mean</span>, <span class="va">nvars</span><span class="op">)</span> <span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">control.sd</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="va">control.sd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">control.sd</span>, <span class="va">nvars</span><span class="op">)</span> <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ncontrol</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">ntreat</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nvars</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">ncontrol</span>, mean<span class="op">=</span><span class="va">control.mean</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, sd<span class="op">=</span><span class="va">control.sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">ntreat</span>, mean<span class="op">=</span><span class="va">treat.mean</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, sd<span class="op">=</span><span class="va">treat.sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'treat'</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nvars</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test.df2</span> <span class="op">&lt;-</span> <span class="fu">getSimulatedData</span><span class="op">(</span></span>
<span>    treat.mean<span class="op">=</span><span class="fl">.6</span>, control.mean<span class="op">=</span><span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/psrange.html">multilevelPSA::psrange</a></code> function will sample with
varying ratios from 1:10 to 1:1. It takes multiple samples and averages
the ranges and distributions of the fitted values from logistic
regression.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psranges2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrange.html">psrange</a></span><span class="op">(</span><span class="va">test.df2</span>, <span class="va">test.df2</span><span class="op">$</span><span class="va">treat</span>, <span class="va">treat</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                     samples<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">1000</span>,by<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, nboot<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>In the figure below propensity score ranges (i.e. fitted values from
a logistic regression) for varying treatment-to-control ratios. For each
panel, 20 random samples of control units were selected ranging from 100
(10% of total available) to 1,000 (100% of total available). For each
sample propensity scores are estimated using logistic regression. The
black bar represents the range from the median of the minimum and
maximum propensity scores. The points for all minimum and maximum values
for all samples are represented by the points. Additionally, density
distributions of the propensity scores for treatment and comparison
groups are provided below and above the line, respectively. As the ratio
of treatment-to-control increases, the range of propensity scores
(i.e. fitted values from logistic regression) shrinks.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">psranges2</span><span class="op">)</span></span></code></pre></div>
<p><img src="shrinking_fitted_values_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" width="100%"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason Bryer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
