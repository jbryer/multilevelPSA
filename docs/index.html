<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multilevel Propensity Score Analysis • multilevelPSA</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Multilevel Propensity Score Analysis">
<meta name="description" content="Conducts and visualizes propensity score analysis for multilevel, or clustered data. Bryer &amp; Pruzek (2011) &lt;doi:10.1080/00273171.2011.636693&gt;.">
<meta property="og:description" content="Conducts and visualizes propensity score analysis for multilevel, or clustered data. Bryer &amp; Pruzek (2011) &lt;doi:10.1080/00273171.2011.636693&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">multilevelPSA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/multilevelPSA.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jbryer/multilevelPSA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level2">
<h2 id="id_-multilevelpsa---an-r-package-for-estimating-and-visualizing-multilevel-propensity-score-models">
<a href="https://github.com/jbryer/multilevelPSA" class="external-link"><img src="reference/figures/multilevelPSA.png" align="right" width="120"></a> multilevelPSA - An R package for estimating and visualizing multilevel propensity score models<a class="anchor" aria-label="anchor" href="#id_-multilevelpsa---an-r-package-for-estimating-and-visualizing-multilevel-propensity-score-models"></a>
</h2>
<!-- badges: start -->

<div class="section level3">
<h3 id="resources">Resources:<a class="anchor" aria-label="anchor" href="#resources"></a>
</h3>
<ul>
<li>This package was developed for my dissertation, <a href="https://scholarsarchive.library.albany.edu/legacy-etd/1090/" class="external-link">A National Study Comparing Charter and Traditional Public Schools Using Propensity Score Analysis</a>. Analysis scripts and manuscript are available on Github here: <a href="https://github.com/jbryer/dissertation" class="external-link uri">https://github.com/jbryer/dissertation</a>.</li>
<li>
<a href="https://psa.bryer.org" class="external-link">Applied Propensity Score Analysis with R</a> book and R package.</li>
</ul>
</div>
<div class="section level3">
<h3 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h3>
<p>As can be seen from the recent Special Issue of MBR on propensity score analysis (PSA) methods, the use of PSA has gained increasing popularity for estimating causal effects in observational studies. However, PSA use with multilevel or clustered data has been limited, and to date there seems to have been no development of specialized graphics for such data. This paper introduces the multilevelPSA (<a href="http://multilevelPSA.r-forge.r-project.org" class="external-link uri">http://multilevelPSA.r-forge.r-project.org</a>) package for R that provides cluster-based functions for estimating propensity scores as well as graphics to exhibit results for multilevel data. This work extends to the multilevel case the framework for visualizing propensity score analysis introduced by Helmreich and Pruzek (2009). International data from the Programme for International Student Assessment (Organization for Economic Co-operation and Development, 2009) are comprehensively examined to compare private with public schools on reading, mathematics, and science outcomes after adjusting for covariate differences in the multilevel context.</p>
<p>Particularly for analyses of large data sets, focusing on statistical significance is limiting. As can readily be seen, overall results favor “private” over “public” schools, at least for end of secondary school math achievement. But the graphics provide a more nuanced understanding of the nature and magnitude of adjusted differences for countries. Furthermore, the graphics are readily interpreted by a nontechnical audience. Broadly speaking, it is seen that modern graphics can enhance and extend conventional numerical summaries by focusing on details of what data have to say for multilevel comparisons of many countries based on propensity score methods.</p>
</div>
<div class="section level3">
<h3 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'multilevelPSA'</span><span class="op">)</span></span>
<span><span class="co">#&gt; To cite multilevelPSA in publications, please use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Bryer, J.M. &amp; Pruzek, R.M. (2011). An international comparison of</span></span>
<span><span class="co">#&gt;   private and public schools using multilevel propensity score methods</span></span>
<span><span class="co">#&gt;   and graphics (Abstract). Multivariate Behavior Research 46, 1011-1011</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Article{,</span></span>
<span><span class="co">#&gt;     author = {Jason M. Bryer and Robert M. Pruzek},</span></span>
<span><span class="co">#&gt;     title = {An international comparison of private and public schools using multilevel propensity score methods and graphics (Abstract)},</span></span>
<span><span class="co">#&gt;     year = {2011},</span></span>
<span><span class="co">#&gt;     number = {46},</span></span>
<span><span class="co">#&gt;     pages = {1010--1011},</span></span>
<span><span class="co">#&gt;     journal = {Multivariate Behavior Research},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h3>
<p>The following example demonstrates how to get started the <code>multilevelPSA</code> package. A more detailed explaination is available in the package vignette (<code><a href="articles/multilevelPSA.html">vignette(topic = 'multilevelPSA')</a></code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'multilevelPSA'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or install the package from Github</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'multilevelPSA'</span>, <span class="st">'jbryer'</span><span class="op">)</span></span></code></pre></div>
<p>Example estimating the effects of private versus public schools in North America using the 2009 Programme of International Student Assessment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/jbryer/multilevelPSA" class="external-link">multilevelPSA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://party.R-forge.R-project.org" class="external-link">party</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the Programme for International Student Assessment data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pisana"</span>, package <span class="op">=</span> <span class="st">'multilevelPSA'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pisa.psa.cols"</span>, package <span class="op">=</span> <span class="st">'multilevelPSA'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate the propensity scores</span></span>
<span><span class="va">mlctree</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mlpsa.ctree.html">mlpsa.ctree</a></span><span class="op">(</span><span class="va">pisana</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CNT'</span>,<span class="st">'PUBPRIV'</span>,<span class="va">pisa.psa.cols</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                       formula <span class="op">=</span> <span class="va">PUBPRIV</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                       level2 <span class="op">=</span> <span class="st">'CNT'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the strata</span></span>
<span><span class="va">student.party</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getStrata.html">getStrata</a></span><span class="op">(</span><span class="va">mlctree</span>, <span class="va">pisana</span>, level2 <span class="op">=</span> <span class="st">'CNT'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a total math score as the average of the five imputed scores</span></span>
<span><span class="va">student.party</span><span class="op">$</span><span class="va">mathscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">student.party</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'PV'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">'MATH'</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># Estimate the causal effects</span></span>
<span><span class="va">results.psa.math</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mlpsa.html">mlpsa</a></span><span class="op">(</span>response<span class="op">=</span><span class="va">student.party</span><span class="op">$</span><span class="va">mathscore</span>, </span>
<span>                         treatment<span class="op">=</span><span class="va">student.party</span><span class="op">$</span><span class="va">PUBPRIV</span>, </span>
<span>                         strata<span class="op">=</span><span class="va">student.party</span><span class="op">$</span><span class="va">strata</span>, </span>
<span>                         level2<span class="op">=</span><span class="va">student.party</span><span class="op">$</span><span class="va">CNT</span>, minN<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results.psa.math</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-pisa-math-plot-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=multilevelPSA" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/jbryer/multilevelPSA/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/jbryer/multilevelPSA/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing multilevelPSA</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jason Bryer <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-2454-0402" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=multilevelPSA" class="external-link"><img src="https://www.r-pkg.org/badges/version/multilevelPSA?color=orange"></a></li>
<li><a href="https://github.com/jbryer/multilevelPSA" class="external-link"><img src="https://img.shields.io/badge/devel%20version-1.2.6-blue.svg"></a></li>
<li><a href="https://github.com/jbryer/multilevelPSA/actions" class="external-link"><img src="https://github.com/jbryer/multilevelPSA/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason Bryer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
